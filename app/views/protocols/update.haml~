.active-scaffold
  .update-view.view
    %ol.form
      - form_for :protocol, @protocol, :url => { :action => 'save', :id => @protocol.id} , :html => {:multipart => true} do |f|
        - unless params["parent_model"].blank?
          %li.form-element
            %dl
              %dt
                %label{ :for => "record-experiment" }
                  Experiment title
              %dd= Experiment.find(session[:exp_id]).title
            = hidden_field :experiment_id, session[:exp_id]
          %li.form-element
            %dl
              %dt
                %label{ :for => "record-description" }
                  Description
              %dd= f.text_area :description
          %br/
          %li.form-element
            %dl
              %dt
                %label{ :for => "record-workpackage" }
                  Workpackage
              %dd= select(:protocol, :workpackage_id, Workpackage.find(:all).collect {|w| [ w.nr, w.nr ] })
        - if @protocol.text
          - fields_for :document, @protocol.document do |document_fields|
            %li.form-element
              %dl
                %dt
                  %label{ :for => "record_Name" }
                    Name
                %dd
                  = document_fields.text_field :name
            %li.form-element
              %dl
                %dt
                  %label{ :for => "record_document" }
                    Text
                %dd
                  = document_fields.text_area :text
        - elsif @protocol.uri
          - fields_for :document, @protocol.document do |document_fields|
            %li.form-element
              %dl
                %dt
                  %label{ :for => "record_document" }
                    URL
                %dd
                  = document_fields.text_field :name
        - elsif @protocol.file
          - fields_for :document, @protocol.document do |document_fields|
            %li.form-element
              %dl
                %dt
                  %label{ :for => "record_document" }
                    Replacement for
                    = File.basename(@protocol.document.file)
                %dd
                  - @document = @protocol.document
                  = file_column_field "document", "file", :class => "document-input text-input",:id => "record_file"
        %p
          %hr/
          - fields_for :document, @protocol.document do |document_fields|
          %li.form-element
            %dl
              %dt
                %label{ :for => "record_document" }
                  Upload a file
              %dd
                - @document = @protocol.document
                = file_column_field "document", "file", :class => "document-input text-input",:id => "record_file"
            %p
              %hr/
              %dl
                %dt
                  %label{ :for => "record_document" }
                    %em
                      %b
                        or
                    enter name and text of the protocol
                %dd
                  Name:
                  %br/
                  = document_fields.text_field :name
                  %p
                    Text:
                    %br/
                    = document_fields.text_area :text
            %p
              %hr/
              %dl
                %dt
                  %label{ :for => "record_document" }
                    %em
                      %b
                        or
                    provide a valid internet address (URL)
                %dd
                  = document_fields.text_field :url

      %p.form-footer
        = submit_tag as_('Update'), :class => "submit"
        = link_to as_('Cancel'), params_for(:action => 'list'), :class => 'cancel'
        = loading_indicator_tag(:action => :update, :id => params[:id])
      %script{ :type => "text/javascript" }
        Form.focusFirstElement('<haml:loud> element_form_id(:action => :update) </haml:loud>');

